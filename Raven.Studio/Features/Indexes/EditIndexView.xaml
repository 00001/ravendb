<UserControl x:Name="this"
			 x:Class="Raven.Studio.Features.Indexes.EditIndexView"
			 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:Editors="clr-namespace:Raven.Studio.Controls.Editors"
			 xmlns:sdk="http://schemas.microsoft.com/winfx/2006/xaml/presentation/sdk"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:Models="clr-namespace:Raven.Studio.Models"
             xmlns:toolkit="http://schemas.microsoft.com/winfx/2006/xaml/presentation/toolkit" mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Models:IndexDefinitionModel, IsDesignTimeCreatable=False}">
	<toolkit:DockPanel Margin="{StaticResource Margin_ContentPage}">
        <Border Background="{StaticResource Brush_HeaderBackground}" CornerRadius="4,4,0,0"
                toolkit:DockPanel.Dock="Top">
            <toolkit:DockPanel Margin="4" LastChildFill="False">
                <StackPanel Orientation="Horizontal">
                    <Image Source="{StaticResource Image_DocumentIndex_Tiny}" Stretch="None" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <HyperlinkButton Content="Indexes" Style="{StaticResource Style_Link_Breadcrumb_Initial}"
                                     NavigateUri="/Indexes"/>
                    <TextBlock Text=">" VerticalAlignment="Center" Margin="4,0"/>
                    <TextBlock Text="{Binding Name}" Style="{StaticResource Style_TextBlock_Breadcrumb}" VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" toolkit:DockPanel.Dock="Right">
                        <Button x:Name="Save" Style="{StaticResource Style_Button_PageHeaderBar}"
										 HorizontalAlignment="Left"
										 Margin="4 0 0 0"
										 ToolTipService.ToolTip="Save Index"
										 Command="{Binding SaveIndex}">
                        <Image Source="{StaticResource Image_Save_Small}" Stretch="None"/>
                    </Button>

                    <Button x:Name="Reset" Style="{StaticResource Style_Button_PageHeaderBar}"
										 HorizontalAlignment="Left"
										 Margin="4 0 0 0"
										 ToolTipService.ToolTip="Undo all changes"
										 Command="{Binding ResetIndex}">
                        <Image Source="{StaticResource Image_Undo_Small}" Stretch="None"/>
                    </Button>
                </StackPanel>
            </toolkit:DockPanel>
        </Border>
		<ScrollViewer BorderThickness="0"
					  VerticalScrollBarVisibility="Auto"
					  HorizontalScrollBarVisibility="Disabled">

			<Grid Style="{StaticResource PagePadding}">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="60" />
					<ColumnDefinition Width="*" />
				</Grid.ColumnDefinitions>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="*" />
					<RowDefinition Height="Auto" />
				</Grid.RowDefinitions>

				<TextBlock Text="Name" />
				<TextBox Grid.Column="1"
						 Text="{Binding Name, Mode=TwoWay}"
						 Margin="0 0 0 8" />

				<StackPanel Grid.Row="1"
							Grid.Column="1"
							Orientation="Horizontal">

					<HyperlinkButton x:Name="AddMap"
									 ToolTipService.ToolTip="Add map to the index"
									 VerticalAlignment="Top"
									 HorizontalAlignment="Left"
									 Content="Add map"
									 Margin="0 0 0 6"
									 Command="{Binding Path=AddMap}" />
					
					<HyperlinkButton x:Name="AddReduce"
									 Visibility="{Binding Reduce, Converter={StaticResource HiddenWhenNotNull}}"
									 Command="{Binding AddReduce}"
									 VerticalAlignment="Top"
									 HorizontalAlignment="Left"
									 Margin="0 0 0 6"
									 Content="Add Reduce" />

					<HyperlinkButton x:Name="AddTransformResults"
									 Visibility="{Binding TransformResults, Converter={StaticResource HiddenWhenNotNull}}"
									 Command="{Binding AddTransformResults}"
									 VerticalAlignment="Top"
									 HorizontalAlignment="Left"
									 Margin="0 0 0 6"
									 Content="Add Transform Results" />

					<HyperlinkButton x:Name="AddField"
									 Command="{Binding AddField}"
									 VerticalAlignment="Top"
									 HorizontalAlignment="Left"
									 Margin="0 0 0 6"
									 Content="Add Field Results" />
					
				</StackPanel>

				
				<TextBlock Text="Maps" Grid.Row="2" />
				<ItemsControl ItemsSource="{Binding Maps}"
							  Grid.Row="2"
							  Grid.Column="1">
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<Grid>
								<Grid.RowDefinitions>
									<RowDefinition Height="Auto" MinHeight="100" />
									<RowDefinition Height="Auto" />
									<RowDefinition Height="Auto" />
									<RowDefinition Height="*" />
								</Grid.RowDefinitions>

								<Editors:LinqEditor Text="{Binding Text, Mode=TwoWay}"
													Style="{StaticResource LinqEditor}" />

								<sdk:GridSplitter Grid.Row="1"
												  Background="Transparent"
												  HorizontalAlignment="Stretch" />

								<HyperlinkButton x:Name="RemoveMap"
												 Visibility="{Binding Path=DataContext.Maps.Count, ElementName=this, Converter={StaticResource HiddenWhenLessOrEqualTo}, ConverterParameter=1}"
												 Grid.Row="2"
												 HorizontalAlignment="Right"
												 Margin="0,0,4,0"
												 ToolTipService.ToolTip="Remove this map from the index"
												 Content="Remove"
												 Command="{Binding Path=DataContext.RemoveMap, ElementName=this}"
												 CommandParameter="{Binding}" />
							</Grid>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>

				<TextBlock Text="Reduce"
						   Visibility="{Binding Reduce, Converter={StaticResource HiddenWhenNull}}"
						   Grid.Row="3" />
				<Grid Grid.Row="3"
							Grid.Column="1"
							Visibility="{Binding Reduce, Converter={StaticResource HiddenWhenNull}}">
					<Grid.RowDefinitions>
						<RowDefinition Height="*" MinHeight="100" />
						<RowDefinition Height="Auto" />
					</Grid.RowDefinitions>
					<Editors:LinqEditor Text="{Binding Reduce, Mode=TwoWay}"
										Style="{StaticResource LinqEditor}" />
					<HyperlinkButton Grid.Row="1"
									 x:Name="RemoveReduce"
									 ToolTipService.ToolTip="Remove reduce statement from the index definition"
									 Content="Remove"
									 HorizontalAlignment="Right"
									 Command="{Binding RemoveReduce}"
									 CommandParameter="{Binding}" />
				</Grid>

				<sdk:GridSplitter Grid.Row="4"
								  Grid.Column="1"
								  Visibility="{Binding Reduce, Converter={StaticResource HiddenWhenNull}}"
								  Background="Transparent"
								  HorizontalAlignment="Stretch" />

				
				<TextBlock Text="Transform"
						   Visibility="{Binding TransformResults, Converter={StaticResource HiddenWhenNull}}"
						   Grid.Row="5" />
				<Grid Grid.Row="5"
							Grid.Column="1"
							Visibility="{Binding TransformResults, Converter={StaticResource HiddenWhenNull}}">
					<Grid.RowDefinitions>
						<RowDefinition Height="*"
									   MinHeight="100" />
						<RowDefinition Height="Auto" />
					</Grid.RowDefinitions>

					<Editors:LinqEditor Text="{Binding TransformResults, Mode=TwoWay}" />
					<HyperlinkButton Grid.Row="1" 
									 x:Name="RemoveTransformResults"
									 ToolTipService.ToolTip="Remove transform results statement from the index definition"
									 Content="Remove"
									 HorizontalAlignment="Right"
									 VerticalAlignment="Bottom"
									 Command="{Binding RemoveTransformResults}"
									 CommandParameter="{Binding}" />
				</Grid>

				<sdk:GridSplitter Grid.Row="6"
								  Grid.Column="1"
								  Visibility="{Binding TransformResults, Converter={StaticResource HiddenWhenNull}}"
								  Background="Transparent"
								  HorizontalAlignment="Stretch" />


				<TextBlock Text="Fields"
						   Visibility="{Binding Path=Fields.Count, Converter={StaticResource HiddenWhenEmpty}}"
						   Grid.Row="7" />
				<ItemsControl ItemsSource="{Binding Fields}"
							  Visibility="{Binding Path=Fields.Count, Converter={StaticResource HiddenWhenEmpty}}"
							  Style="{StaticResource Style_ItemsControl_Fluid}"
							  Grid.Row="7"
							  Grid.Column="1">
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<Border BorderBrush="{StaticResource DividerBrush}"
									BorderThickness="1,0,0,0"
									CornerRadius="5"
									Margin="0,0,15,8"
									VerticalAlignment="Top"
									HorizontalAlignment="Left">
								<Grid Margin="4,4,0,4">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="Auto" />
										<ColumnDefinition Width="Auto" />
										<ColumnDefinition Width="Auto" />
										<ColumnDefinition Width="Auto" />
										<ColumnDefinition Width="*" />
									</Grid.ColumnDefinitions>
									<Grid.RowDefinitions>
										<RowDefinition Height="Auto" />
										<RowDefinition Height="4" />
										<RowDefinition Height="Auto" />
										<RowDefinition Height="4" />
										<RowDefinition Height="Auto" />
									</Grid.RowDefinitions>

									<TextBlock Text="Field" />
									<TextBox Text="{Binding Name, Mode=TwoWay}"
											 Grid.Column="1"
											 Grid.ColumnSpan="3" />
									<HyperlinkButton x:Name="RemoveField"
													 Grid.Column="4"
													 HorizontalAlignment="Left"
													 Margin="4 0 0 0"
													 ToolTipService.ToolTip="Remove this field from the index"
													 Content="Remove"
													 Command="{Binding Path=DataContext.RemoveField, ElementName=this}"
													 CommandParameter="{Binding}" />


									<TextBlock Text="Storage"
											 Grid.Row="2" />
									<ComboBox ItemsSource="{Binding Storage, Converter={StaticResource enumerationFromValue}, Mode=OneTime}"
											  SelectedItem="{Binding Storage, Converter={StaticResource enumeratedValue}, Mode=TwoWay}"
											  Grid.Row="2"
											  Grid.Column="1"
											  MinWidth="80" />

									<TextBlock Text="Indexing"
											 Grid.Row="2"
											 Grid.Column="2"
											 Margin="8,0,4,0" />
									<ComboBox ItemsSource="{Binding Indexing, Converter={StaticResource enumerationFromValue}, Mode=OneTime}"
											  SelectedItem="{Binding Indexing, Converter={StaticResource enumeratedValue}, Mode=TwoWay}"
											  Grid.Row="2"
											  Grid.Column="3" />

									<TextBlock Text="Sort"
											 Grid.Row="4" />
									<ComboBox ItemsSource="{Binding Sort, Converter={StaticResource enumerationFromValue}, Mode=OneTime}"
											  SelectedItem="{Binding Sort, Converter={StaticResource enumeratedValue}, Mode=TwoWay}"
											  Grid.Row="4"
											  Grid.Column="1" />

									<TextBlock Text="Analyzer"
											 Grid.Row="4"
											 Grid.Column="2"
											 Margin="8,0,4,0" />
									<TextBox Text="{Binding Analyzer}"
											 Grid.Row="4"
											 Grid.Column="3"
											 MinWidth="160" />
								</Grid>
							</Border>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>
				
				<sdk:GridSplitter Grid.Row="8"
								  Grid.Column="1"
								  Visibility="{Binding Path=Fields.Count, Converter={StaticResource HiddenWhenEmpty}}"
								  Background="Transparent"
								  HorizontalAlignment="Stretch" />

				<Grid Grid.Row="10"
					  Grid.Column="2">
					<StackPanel>
						<HyperlinkButton Content="{Binding ErrorsCount, StringFormat='\{0\} errors'}"
										 Visibility="{Binding ErrorsCount, Converter={StaticResource HiddenWhenEmpty}}"
										 NavigateUri="{Binding Name, StringFormat='/indexes-errors/\{0\}'}" />
					</StackPanel>
					
				</Grid>

			</Grid>
		</ScrollViewer>
    </toolkit:DockPanel>
</UserControl>