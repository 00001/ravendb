<Infrastructure:View x:Class="Raven.Studio.Features.Query.QueryView"
					 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
					 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
					 xmlns:Infrastructure="clr-namespace:Raven.Studio.Infrastructure"
					 xmlns:toolkit="http://schemas.microsoft.com/winfx/2006/xaml/presentation/toolkit"
					 xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
					 xmlns:Documents="clr-namespace:Raven.Studio.Features.Documents"
					 xmlns:Editors="clr-namespace:Raven.Studio.Controls.Editors"
					 xmlns:ei="http://schemas.microsoft.com/expression/2010/interactions"
					 xmlns:sdk="http://schemas.microsoft.com/winfx/2006/xaml/presentation/sdk">

	<Infrastructure:View.Resources>
		<Style x:Key="PanelTitle"
			   TargetType="TextBlock">
			<Setter Property="FontSize"
					Value="10.667" />
			<Setter Property="Foreground"
					Value="#7F000000" />
		</Style>
	</Infrastructure:View.Resources>

	<toolkit:DockPanel Margin="{StaticResource Margin_ContentPage}">
		<Border Background="{StaticResource Brush_HeaderBackground}"
				MinHeight="40"
				Margin="0,0,0,20"
				CornerRadius="4,4,0,0"
				toolkit:DockPanel.Dock="Top">
			<toolkit:DockPanel Margin="4"
							   LastChildFill="False">
				<StackPanel Orientation="Horizontal">
					<Image Source="{StaticResource Image_DocumentIndex_Tiny}"
						   Stretch="None"
						   VerticalAlignment="Center"
						   Margin="2" />
					<HyperlinkButton Content="Indexes"
									 Style="{StaticResource Style_Link_Breadcrumb_Initial}"
									 Command="{StaticResource NavigateToCommand}"
									 CommandParameter="/Indexes"
									 VerticalAlignment="Center" />
					<TextBlock Text=">"
							   VerticalAlignment="Center"
							   Margin="4,0" />
					<HyperlinkButton Content="{Binding IndexName}"
									 Style="{StaticResource Style_Link_Breadcrumb_Initial}"
									 Command="{StaticResource NavigateToCommand}"
									 CommandParameter="{Binding IndexName, StringFormat=/indexes/\{0\}}"
									 VerticalAlignment="Center" />
					<TextBlock Text=">"
							   VerticalAlignment="Center"
							   Margin="4,0" />
					<TextBlock Text="Query"
							   Style="{StaticResource Style_TextBlock_Breadcrumb}"
							   VerticalAlignment="Center" />
				</StackPanel>

				<StackPanel Orientation="Horizontal"
							toolkit:DockPanel.Dock="Right"
							VerticalAlignment="Center">

					<Button x:Name="AddSortBy"
							Style="{StaticResource Style_Button_MouseOverChrome}"
							ToolTipService.ToolTip="Add sort by option for this query"
							VerticalAlignment="Center"
							HorizontalAlignment="Left"
							Margin="0"
							Command="{Binding AddSortBy}"
							Visibility="{Binding Path=SortByOptions.Count, Converter={StaticResource HiddenWhenEmpty}}"
							VerticalContentAlignment="Center">
						<Button.Content>
							<StackPanel Orientation="Horizontal"
										VerticalAlignment="Center">
								<Image Source="{StaticResource Image_Add_Tiny}"
									   Stretch="None"
									   VerticalAlignment="Center" />
								<TextBlock Text="Add Map"
										   VerticalAlignment="Center"
										   Margin="2,0,0,0" />
							</StackPanel>
						</Button.Content>
					</Button>
				</StackPanel>
			</toolkit:DockPanel>
		</Border>

		<Grid>
			<Grid.RowDefinitions>
				<RowDefinition Height="*"
							   MinHeight="100" />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="4*" />
			</Grid.RowDefinitions>
			
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
					<RowDefinition Height="*" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
				</Grid.RowDefinitions>

				<TextBlock Style="{StaticResource PanelTitle}"
						   Text="Query" />

				<Editors:QueryEditor x:Name="QueryEditor" Grid.Row="1"
									 Text="{Binding Path=Query.Value, Mode=TwoWay}"
									 CompletionProvider="{Binding Path=CompletionProvider.Value}">
					<i:Interaction.Triggers>
						<ei:KeyTrigger Key="Enter"
									   Modifiers="Control">
							<i:InvokeCommandAction Command="{Binding Execute}" />
						</ei:KeyTrigger>
					</i:Interaction.Triggers>
				</Editors:QueryEditor>

				<Grid Grid.Row="2">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*" />
						<ColumnDefinition Width="Auto" />
					</Grid.ColumnDefinitions>

					<StackPanel Visibility="{Binding IsSpatialQuerySupported, Mode=TwoWay, Converter={StaticResource VisibleWhenTrue}}">
						<CheckBox Content="Make spatial queries"
								  IsChecked="{Binding IsSpatialQuery, Mode=TwoWay}" />

						<StackPanel Orientation="Horizontal"
									Visibility="{Binding IsSpatialQuery, Mode=TwoWay, Converter={StaticResource VisibleWhenTrue}}">
							<TextBlock Text="Longitude:" />
							<TextBox Margin="5,0,5,0"
									 Width="100"
									 Text="{Binding Longitude}" />

							<TextBlock Text="Latitude:" />
							<TextBox Margin="5,0,5,0"
									 Width="100"
									 Text="{Binding Latitude}" />

							<TextBlock Text="Radius:" />
							<TextBox Margin="5,0,5,0"
									 Width="100"
									 Text="{Binding Radius}"/>
						</StackPanel>
					</StackPanel>

					<HyperlinkButton Content="Execute"
									 Grid.Column="1"
									 Command="{Binding Execute}"
									 HorizontalAlignment="Right" />
				</Grid>
				
				<StackPanel Visibility="{Binding Path=SortBy.Count, Converter={StaticResource HiddenWhenEmpty}}"
							Grid.Row="3">
					<TextBlock Text="Sort By" />
					<ItemsControl ItemsSource="{Binding SortBy}">
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<StackPanel>
									<ComboBox ItemsSource="{Binding SortByOptions}" />
									<HyperlinkButton Command="{Binding RemoveSortBy}"
													 CommandParameter="{Binding}"
													 Content="Remove Sort By" />
								</StackPanel>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</StackPanel>
			</Grid>

			<sdk:GridSplitter Grid.Row="1"
							  Background="Transparent"
							  HorizontalAlignment="Stretch" />

			<StackPanel Grid.Row="2">
				<TextBlock Text="{Binding Error}"
						   Visibility="{Binding Error, Converter={StaticResource HiddenWhenNull}}" />
				<StackPanel Visibility="{Binding Path=DocumentsResult.Value, Converter={StaticResource HiddenWhenNull}}">
					<Documents:DocumentsView Margin="{StaticResource Margin_ContentPage}"
											 DataContext="{Binding Path=DocumentsResult.Value}" />
				</StackPanel>
			</StackPanel>
		</Grid>
	</toolkit:DockPanel>
</Infrastructure:View>